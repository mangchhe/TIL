# AOP 개념

- 애플리케이션 로직에는 핵심 기능과 부가 기능으로 나뉘어 존재한다.
- 부가 기능은 핵심 기능을 보조하기 위해 존재하고 로그, 트랜잭션 등의 동작을 한다.
- 이때 부가 기능을 구현할 때 몇몇 문제점이 발생한다.
    - 중복이 많이 발생한다.
    - 요구사항이 바뀌면 적용 부분에 모두 찾아가 변경해야 한다.
    - 핵심 로직과 함께 공존하여 가독성이 좋지 않다.

## Aspect

- 부가 기능을 핵심 기능에서 분리하여 한 곳에서 관리하기 시작했다.
- 부가 기능과 기능을 어디에 적용할지에 대해서 정의한 것을 Aspect라고 하고 이를 활용한 프로그래밍을 AOP라 한다.
- `@Aspect` = Advisor = Pointcut + Advice

> AspectJ 프레임워크
>
> AOP의 대표적인 구현으로 AspectJ 프레임워크가 있고 스프링 AOP는 대부분 AspectJ 문법을 빌려 쓰고, AspectJ에 일부 기능만 제공한다.

## AOP 적용 방식
 
- 분리되어 있는 부가 기능을 실제 기능에 추가하는 세 가지 방법
    - 컴파일 시점
    - 클래스 로딩 시점
    - 런타임 시점(프록시)

### 컴파일 시점

- .java 코드에서 .class로 컴파일할 때 부가 기능 로직을 추가한다.
- AspectJ가 제공하는 특별한 컴파일러를 사용하여 부가 기능 적용 대상 클래스인지 확인하고 추가한다.
- 원본 로직에 부가 기능 로직을 추가하는 것을 위빙이라 한다.
- 컴파일 시점에 부가 기능을 추가하는 것은 특별한 컴파일러가 필요하고 복잡하다.

### 클래스 로딩 시점

- JVM 내부에서 .class 파일을 클래스 로더가 읽어 들이는 시점에 부가 기능을 추가시킨다.
- 해당 방식으로 로직을 추가하는 것을 로드 타임 리빙이라고 한다.
- 단점으로는 자바 실행 시에 특별한 옵션을 주어 클래스 로더 조작기를 지정해야 하는데, 번거롭고 운영하기 어렵다.

### 런타임 시점

- 가장 많이 사용하는 방법이다.
- 컴파일이 끝나 .class가 만들어지고 클래스 로더가 읽어 들이고 난 다음을 부가 기능을 추가하는 것을 말한다.
- 스프링 컨테이너의 도움을 받고 DI, 프록시, 빈 후처리기 등 개념 모두 동원하여 부가 기능을 적용할 수 있다.
 
## AOP 적용 위치

- 생성자, 필드 값 접근, static 메서드 접근, 메서드 실행 등 여러 곳에서 AOP를 적용할 수 있다. (적용 지점 = JointPoint)
- AspectJ를 사용하면 바이트코드를 조작하기 때문에 모든 지점에서 적용이 가능하다.
- 하지만, 프록시를 이용하게 된다면 사용 지점이 제한된다.
- 프록시는 메서드 실행 지점에만 사용이 가능하며, 메서드를 오버라이딩 해야 하므로 생성자, static 메서드, 필드 값 접근에는 적용될 수 없다.
- 또한 스프링 빈에만 AOP를 적용할 수 있다는 제약이 존재한다.

## AOP 용어 정리

### Join Point

- 어드바이스가 적용될 수 있는 모든 지점
- 단, 스프링 AOP는 프록시 방식을 사용하기 때문에 메서드 실행 지점으로 제한된다.

### Pointcut

- Join Point 중에서 Advice가 적용될 위치를 선정
- 주로 AspectJ 표현식을 사용한다.

### Target

- 핵심 로직을 가지는 실제 객체

### Advice

- 부가 기능 로직
- Around, Before, After 등과 같은 다양한 Advice 종류가 존재한다.

### Aspect

- Advice + Pointcut을 모듈화 한 것, `@Aspect`

### Advisor

- Advice + Pointcut으로 구성되는 것을 말함
- 스프링 AOP에서만 사용되는 용어

### Weaving

- Pointcut으로 결정한 타켓의 Join Point에 Advice를 적용하는 것을 말함
- 핵심 기능에 영향을 주지 않고 부가 기능을 추가할 수 있다.

### AOP Proxy

- AOP 기능을 구현하기 위해 만든 프록시 객체, JDK Dynamic Proxy, CGLIB Proxy를 사용

## Reference

- [스프링 핵심 원리 - 고급편](https://www.inflearn.com/course/%EC%8A%A4%ED%94%84%EB%A7%81-%ED%95%B5%EC%8B%AC-%EC%9B%90%EB%A6%AC-%EA%B3%A0%EA%B8%89%ED%8E%B8/dashboard)